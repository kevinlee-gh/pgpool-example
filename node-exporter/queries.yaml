pg_uptime:
  query: "SELECT EXTRACT(EPOCH FROM now() - pg_postmaster_start_time()) as seconds"
  metrics: 
    - seconds:
        usage: "COUNTER"
        description: "PostgreSQL uptime in seconds"

pg_ha:
  query: |
    SELECT
        CASE
            -- No synchronous replication configured
            WHEN setting = '' THEN 0

            -- ANY <n> (...) => take the number after "ANY"
            WHEN setting ~* '^ANY *([0-9]+)' THEN
                (regexp_match(setting, '^any *([0-9]+)', 'i'))[1]::int

            -- FIRST <n> (...) => take the number after "FIRST"
            WHEN setting ~* '^FIRST *([0-9]+)' THEN
                (regexp_match(setting, '^first *([0-9]+)', 'i'))[1]::int

            -- No ANY / FIRST keywords = FIRST 1 (...)
            ELSE
                1
        END AS min_sync_standbys
    FROM pg_settings
    WHERE name = 'synchronous_standby_names';
  metrics:
    - min_sync_standbys:
        usage: "GAUGE"
        description: "Minimum number of synchronous standbys required"
  